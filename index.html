<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Task Manager ‚Äî Final</title>
<style>
:root{
  --accent:#ffca28;
  --accent-dark:#f0b400;
  --glass: rgba(255,255,255,0.06);
  --card: rgba(255,255,255,0.04);
  --muted: rgba(255,255,255,0.75);
  --success:#00ff88;
  --danger:#ef5350;
  --info:#29b6f6;
  --bg-overlay: rgba(0,0,0,0.55);
}

/* Page background */
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:#fff;}
body {
  background: url("2.png") center/cover no-repeat fixed;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:36px 20px;
  box-sizing:border-box;
}
body::before{ content:""; position:fixed; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.65)); pointer-events:none; }

/* App container 50/50 */
.app {
  width:100%;
  max-width:1150px;
  display:grid;
  grid-template-columns:420px 1fr;
  gap:24px;
  z-index:1;
}

/* Panels */
.panel {
  background:var(--bg-overlay);
  padding:20px;
  border-radius:14px;
  box-shadow:0 8px 30px rgba(0,0,0,0.5);
  backdrop-filter:blur(6px);
}

/* Left: form */
.panel h2 { margin:0 0 12px 0; font-size:20px; font-weight:700; text-align:center; }
label { display:block; font-size:13px; color:#e6f2ff; margin:8px 0 6px; }
input[type="text"], textarea, input[type="date"], select {
  width:100%; padding:10px 12px; border-radius:10px; border:none; outline:none;
  background: rgba(255,255,255,0.03); color:#fff; font-size:15px; box-sizing:border-box;
}
textarea{ min-height:80px; resize:vertical; padding-top:10px; }

/* nicer selects/options so they render legibly */
select { appearance:none; -webkit-appearance:none; -moz-appearance:none; position:relative; color:#fff; }
select option { color:#111; }

/* form layout */
.row { display:flex; gap:10px; }
.small { width:140px; }

/* buttons */
.btn { background:var(--accent); color:#000; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; }
.btn.secondary { background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.08); }
.btn.ghost { background:transparent; border:1px dashed rgba(255,255,255,0.06); color:#fff; }

/* Right top card style (Option C) */
.progress-card {
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
  padding:18px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.03);
}
.progress-left { display:flex; gap:12px; align-items:center; min-width:320px; }
.progress-title { font-weight:800; font-size:18px; margin-right:6px; }
.progress-bar { height:12px; background:rgba(255,255,255,0.06); border-radius:10px; width:260px; overflow:hidden; }
.progress-fill { height:100%; width:0%; background:var(--success); border-radius:10px; transition:width 400ms ease; }
.progress-percent { font-weight:800; color:#dfffe6; min-width:48px; text-align:right; }

/* Filters column on card */
.progress-filters { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.filter-btn { padding:8px 14px; border-radius:999px; background:rgba(255,255,255,0.06); color:#fff; font-weight:700; cursor:pointer; border:none; }
.filter-btn.active { background:var(--accent); color:#000; }

/* task list panel styling */
.top-controls { display:flex; gap:12px; align-items:center; margin-top:12px; margin-bottom:10px; flex-wrap:wrap; }
.search-row { display:flex; gap:8px; align-items:center; margin-left:auto; }
.search-row input { padding:8px 12px; border-radius:8px; border:none; background:rgba(255,255,255,0.03); color:#fff; }

/* task cards */
.task-list { display:flex; flex-direction:column; gap:12px; }
.task { display:flex; justify-content:space-between; gap:16px; padding:14px; border-radius:12px; background:var(--card); border:1px solid rgba(255,255,255,0.03); }
.left { max-width:66%; }
.left h3 { margin:0 0 6px 0; font-size:18px; }
.meta { font-size:13px; color:#dff3ff; opacity:0.95; margin-bottom:8px; }
.labels { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:6px; }
.priority { padding:6px 8px; border-radius:8px; font-weight:700; font-size:13px; color:#000; }
.prio-high { background:#ff6b6b; } .prio-med { background:#ffd66b; } .prio-low { background:#8ef0a8; }

/* status badge */
.status { font-weight:700; padding:8px 10px; border-radius:10px; font-size:13px; color:#000; }
.s-pending { background:#ffcdd2; color:#7b0000; }
.s-half { background:#ffd880; color:#4b3200; }
.s-completed { background:var(--success); color:#003f20; }

/* actions */
.actions { display:flex; gap:8px; align-items:center; }
.small-btn { padding:8px 10px; border-radius:8px; border:none; cursor:pointer; font-weight:700; color:#fff; }
.edit { background:var(--info); } .del { background:var(--danger); }

/* modal */
.modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); z-index:99; }
.modal-box { background:#0e1116; padding:18px; border-radius:12px; width:520px; color:#eaf6ff; box-shadow:0 8px 30px rgba(0,0,0,0.6); }

/* delete modal styling overrides */
#deleteConfirmBtn { background:#ef5350; color:#fff; font-weight:700; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; }
#deleteCancelBtn { background:transparent; border:1px solid rgba(255,255,255,0.12); color:#fff; padding:10px 14px; border-radius:10px; cursor:pointer; }

/* responsive */
@media (max-width:980px) {
  .app { grid-template-columns: 1fr; }
  .panel { order:2; }
  .progress-left { min-width:160px; }
  .progress-bar { width:140px; }
}
</style>
</head>
<body>
  <div class="app">

    <!-- LEFT: Add Form -->
    <div class="panel">
      <h2>Add / Edit Task</h2>

      <label>Title</label>
      <input id="title" type="text" placeholder="Task title">

      <label>Description (optional)</label>
      <textarea id="desc" placeholder="Short description"></textarea>

      <div class="row" style="margin-top:8px;">
        <div style="flex:1">
          <label>Category</label>
          <select id="category">
            <option value="Personal">üßç Personal</option>
            <option value="Study">üìò Study</option>
            <option value="Work">üíº Work</option>
            <option value="Developer">üíª Developer</option>
          </select>
        </div>

        <div style="width:140px">
          <label>Priority</label>
          <select id="priority">
            <option value="High">High</option>
            <option value="Medium" selected>Medium</option>
            <option value="Low">Low</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div style="flex:1">
          <label>Due Date</label>
          <input id="dueDate" type="date">
        </div>

        <div style="width:170px">
          <label>Status</label>
          <select id="status">
            <option value="Pending">Pending</option>
            <option value="Half Completed">Half Completed</option>
            <option value="Completed">Completed</option>
          </select>
        </div>
      </div>

      <div id="completionRow" style="display:none;margin-top:10px;">
        <label>Completion Date (if Completed)</label>
        <input id="completionDate" type="date">
      </div>

      <div style="display:flex; gap:8px; margin-top:14px;">
        <button class="btn" id="saveBtn">Save Task</button>
        <button class="btn secondary" id="resetBtn">Reset</button>
        <button class="btn ghost" id="exportBtn">Export</button>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
        <button class="btn ghost" id="importBtn">Import</button>
      </div>

      <div style="margin-top:14px; font-size:13px; color:#cfe7ff; opacity:0.9;">
        Tip: select <b>Completed</b> to show completion date field.
      </div>
    </div>

    <!-- RIGHT: Progress Card + Controls -->
    <div style="display:flex; flex-direction:column; gap:12px;">

      <!-- Option C: Card-style progress & filters -->
      <div class="progress-card">
        <div class="progress-left">
          <div class="progress-title">Progress</div>
          <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
          <div id="progressText" class="progress-percent">0%</div>
        </div>

        <div class="progress-filters">
          <button class="filter-btn active" data-filter="All">All</button>
          <button class="filter-btn" data-filter="Pending">Pending</button>
          <button class="filter-btn" data-filter="Half Completed">Half</button>
          <button class="filter-btn" data-filter="Completed">Completed</button>
        </div>
      </div>

      <!-- Tasks panel -->
      <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <h3 style="margin:0">Your Tasks</h3>
          <div style="font-size:13px; opacity:0.9;">Saved in LocalStorage</div>
        </div>

        <div class="top-controls">
          <div style="display:flex; gap:8px; align-items:center;">
            <select id="filterCategory">
              <option value="All">All Categories</option>
              <option value="Personal">Personal</option>
              <option value="Study">Study</option>
              <option value="Work">Work</option>
              <option value="Developer">Developer</option>
            </select>

            <select id="filterPriority">
              <option value="All">All Priorities</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>

            <select id="sortBy">
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
              <option value="due-asc">Due ‚Üó</option>
              <option value="due-desc">Due ‚Üò</option>
            </select>
          </div>

          <div class="search-row">
            <input id="search" type="text" placeholder="Search title or description...">
            <button class="btn ghost" id="clearAllBtn" title="Clear all tasks (dev)">Clear All</button>
          </div>
        </div>

        <div id="taskList" class="task-list"></div>
      </div>
    </div>

  </div>

  <!-- EDIT MODAL -->
  <div id="editModal" class="modal" style="display:none;">
    <div class="modal-box">
      <h3>Edit Task</h3>
      <label>Title</label>
      <input id="e_title" type="text">

      <label>Description</label>
      <textarea id="e_desc"></textarea>

      <div style="display:flex; gap:8px; margin-top:8px;">
        <select id="e_category" style="flex:1;">
          <option value="Personal">üßç Personal</option>
          <option value="Study">üìò Study</option>
          <option value="Work">üíº Work</option>
          <option value="Developer">üíª Developer</option>
        </select>

        <select id="e_priority" style="width:140px;">
          <option value="High">High</option>
          <option value="Medium">Medium</option>
          <option value="Low">Low</option>
        </select>
      </div>

      <div style="display:flex; gap:8px; margin-top:10px;">
        <input id="e_dueDate" type="date" style="flex:1;">
        <select id="e_status" style="width:170px;">
          <option value="Pending">Pending</option>
          <option value="Half Completed">Half Completed</option>
          <option value="Completed">Completed</option>
        </select>
      </div>

      <div id="e_completionRow" style="display:none; margin-top:10px;">
        <label>Completion Date</label>
        <input id="e_completionDate" type="date">
      </div>

      <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
        <button class="btn" id="modalSave">Save</button>
        <button class="btn secondary" id="modalCancel">Cancel</button>
      </div>
    </div>
  </div>

  <!-- DELETE CONFIRMATION MODAL -->
  <div id="deleteModal" class="modal" style="display:none;">
    <div class="modal-box" style="max-width:380px; text-align:center;">
      <h3 style="margin-top:0;">Delete Task?</h3>
      <p style="font-size:14px; opacity:0.8;">
        Are you sure you want to permanently delete this task?
      </p>

      <div style="display:flex; justify-content:center; gap:12px; margin-top:20px;">
        <button id="deleteConfirmBtn">Delete</button>
        <button id="deleteCancelBtn">Cancel</button>
      </div>
    </div>
  </div>

<script>
/* --------------------------
  Final Task Manager JS
  - LocalStorage
  - Add/Edit/Delete with modals
  - Progress card (Option C)
  - Filters, search, sort
  - No 'Load Example' button
-------------------------- */

const STORAGE_KEY = "cognifyz_task_final_v1";
let tasks = [];
let editingId = null;
let deleteTargetId = null;
let currentFilter = "All";

/* init */
document.addEventListener("DOMContentLoaded", () => {
  loadFromStorage();
  bindEvents();
  setActiveFilterBtn('All');
  render();
});

/* load/save */
function loadFromStorage(){
  const raw = localStorage.getItem(STORAGE_KEY);
  tasks = raw ? JSON.parse(raw) : [];
}
function saveToStorage(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
}

/* bind UI events */
function bindEvents(){
  document.getElementById("saveBtn").addEventListener("click", addOrUpdate);
  document.getElementById("resetBtn").addEventListener("click", resetForm);
  document.getElementById("exportBtn").addEventListener("click", exportTasks);
  document.getElementById("importBtn").addEventListener("click", ()=>document.getElementById("importFile").click());
  document.getElementById("importFile").addEventListener("change", handleImport);
  document.getElementById("search").addEventListener("input", render);
  document.getElementById("filterCategory").addEventListener("change", render);
  document.getElementById("filterPriority").addEventListener("change", render);
  document.getElementById("sortBy").addEventListener("change", render);
  document.getElementById("clearAllBtn").addEventListener("click", clearAll);

  document.getElementById("modalSave").addEventListener("click", saveEdit);
  document.getElementById("modalCancel").addEventListener("click", closeEditModal);

  document.getElementById("deleteConfirmBtn").addEventListener("click", confirmDelete);
  document.getElementById("deleteCancelBtn").addEventListener("click", closeDeleteModal);

  // status change to show completion row on add form
  document.getElementById("status").addEventListener("change", ()=> {
    document.getElementById("completionRow").style.display = (document.getElementById("status").value === "Completed") ? "block" : "none";
  });

  // filter buttons on progress card
  document.querySelectorAll(".filter-btn").forEach(btn => {
    btn.addEventListener("click", (e) => {
      const f = e.currentTarget.dataset.filter;
      setActiveFilterBtn(f);
      currentFilter = f;
      render();
    });
  });
}

/* helpers */
function uid(){ return Date.now() + Math.floor(Math.random()*9999); }
function emoji(cat){ return cat==='Personal'?'üßç':(cat==='Study'?'üìò':(cat==='Work'?'üíº':'üíª')); }

/* add or update */
function addOrUpdate(){
  const title = document.getElementById("title").value.trim();
  if (!title) { alert("Enter a title"); return; }
  const task = {
    id: uid(),
    title,
    desc: document.getElementById("desc").value.trim(),
    category: document.getElementById("category").value,
    priority: document.getElementById("priority").value,
    dueDate: document.getElementById("dueDate").value || null,
    status: document.getElementById("status").value,
    completionDate: document.getElementById("completionDate").value || null,
    createdAt: new Date().toISOString()
  };

  if (editingId){
    // update existing
    const t = tasks.find(x => x.id === editingId);
    if (!t) return;
    t.title = task.title; t.desc = task.desc; t.category = task.category; t.priority = task.priority;
    t.dueDate = task.dueDate; t.status = task.status; t.completionDate = (task.status==='Completed' ? task.completionDate : null);
    editingId = null;
  } else {
    tasks.unshift(task);
  }

  saveToStorage();
  resetForm();
  render();
}

/* reset add form */
function resetForm(){
  editingId = null;
  document.getElementById("title").value = "";
  document.getElementById("desc").value = "";
  document.getElementById("category").value = "Personal";
  document.getElementById("priority").value = "Medium";
  document.getElementById("dueDate").value = "";
  document.getElementById("status").value = "Pending";
  document.getElementById("completionDate").value = "";
  document.getElementById("completionRow").style.display = "none";
}

/* render list with filters, search, sort */
function render(){
  const list = document.getElementById("taskList");
  list.innerHTML = "";

  const q = (document.getElementById("search").value || "").toLowerCase();
  const catFilter = document.getElementById("filterCategory").value;
  const prFilter = document.getElementById("filterPriority").value;
  const sortBy = document.getElementById("sortBy").value;

  let filtered = tasks.filter(t => {
    if (currentFilter !== 'All' && t.status !== currentFilter) return false;
    if (catFilter !== 'All' && t.category !== catFilter) return false;
    if (prFilter !== 'All' && t.priority !== prFilter) return false;
    if (q && !(t.title.toLowerCase().includes(q) || (t.desc||"").toLowerCase().includes(q))) return false;
    return true;
  });

  // sort
  filtered.sort((a,b)=>{
    if (sortBy === 'newest') return b.createdAt.localeCompare(a.createdAt);
    if (sortBy === 'oldest') return a.createdAt.localeCompare(b.createdAt);
    if (sortBy === 'due-asc') { if(!a.dueDate) return 1; if(!b.dueDate) return -1; return a.dueDate.localeCompare(b.dueDate); }
    if (sortBy === 'due-desc') { if(!a.dueDate) return 1; if(!b.dueDate) return -1; return b.dueDate.localeCompare(a.dueDate); }
    return 0;
  });

  if (filtered.length === 0){
    list.innerHTML = `<div style="padding:18px;color:#dff3ff;opacity:0.9;">No tasks found</div>`;
  } else {
    filtered.forEach(t => list.appendChild(createTaskNode(t)));
  }

  updateProgress();
}

/* create DOM node for task */
function createTaskNode(t){
  const card = document.createElement('div'); card.className = 'task';
  const left = document.createElement('div'); left.className = 'left';
  const title = document.createElement('h3'); title.textContent = `${emoji(t.category)} ${t.title}`; left.appendChild(title);

  const meta = document.createElement('div'); meta.className = 'meta';
  meta.innerHTML = `<div>${t.category} ‚Ä¢ Priority: <b>${t.priority}</b></div>
    <div style="margin-top:6px">Due: <b>${t.dueDate || '‚Äî'}</b> ${t.completionDate ? `‚Ä¢ Completed: <b>${t.completionDate}</b>` : ''}</div>`;
  left.appendChild(meta);

  const labels = document.createElement('div'); labels.className = 'labels';
  const pri = document.createElement('div'); pri.className = 'priority ' + (t.priority==='High'?'prio-high':(t.priority==='Medium'?'prio-med':'prio-low'));
  pri.textContent = t.priority; labels.appendChild(pri);

  if (t.status === 'Half Completed'){
    const prog = document.createElement('div'); prog.style.width='120px';
    prog.innerHTML = `<div style="height:8px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden">
      <div style="width:50%;height:100%;background:#ffd880"></div></div>`;
    labels.appendChild(prog);
  }
  left.appendChild(labels);

  if (t.desc){
    const desc = document.createElement('div'); desc.style.marginTop='8px'; desc.style.fontSize='13px'; desc.style.opacity='0.95';
    desc.textContent = t.desc; left.appendChild(desc);
  }

  const right = document.createElement('div'); right.className = 'right';
  const statusBadge = document.createElement('div'); statusBadge.className='status ' + (t.status==='Pending'?'s-pending':(t.status==='Half Completed'?'s-half':'s-completed'));
  statusBadge.textContent = t.status; right.appendChild(statusBadge);

  const actions = document.createElement('div'); actions.className='actions';
  const editBtn = document.createElement('button'); editBtn.className='small-btn edit'; editBtn.textContent='Edit';
  editBtn.onclick = ()=> openEditModal(t.id);
  const delBtn = document.createElement('button'); delBtn.className='small-btn del'; delBtn.textContent='Delete';
  delBtn.onclick = ()=> openDeleteModal(t.id);

  actions.appendChild(editBtn); actions.appendChild(delBtn); right.appendChild(actions);

  card.appendChild(left); card.appendChild(right);
  return card;
}

/* update progress */
function updateProgress(){
  const total = tasks.length;
  const done = tasks.filter(t=>t.status==='Completed').length;
  const percent = total === 0 ? 0 : Math.round((done/total)*100);
  document.getElementById('progressFill').style.width = percent + '%';
  document.getElementById('progressText').textContent = percent + '%';
}

/* open edit modal */
function openEditModal(id){
  const t = tasks.find(x=>x.id===id); if(!t) return;
  editingId = id;
  document.getElementById('e_title').value = t.title;
  document.getElementById('e_desc').value = t.desc || '';
  document.getElementById('e_category').value = t.category;
  document.getElementById('e_priority').value = t.priority;
  document.getElementById('e_dueDate').value = t.dueDate || '';
  document.getElementById('e_status').value = t.status || 'Pending';
  document.getElementById('e_completionDate').value = t.completionDate || '';
  document.getElementById('e_completionRow').style.display = (t.status==='Completed') ? 'block' : 'none';
  document.getElementById('editModal').style.display = 'flex';
}

/* save edit */
function saveEdit(){
  if (!editingId) return closeEditModal();
  const t = tasks.find(x=>x.id===editingId);
  t.title = document.getElementById('e_title').value.trim() || t.title;
  t.desc = document.getElementById('e_desc').value.trim();
  t.category = document.getElementById('e_category').value;
  t.priority = document.getElementById('e_priority').value;
  t.dueDate = document.getElementById('e_dueDate').value || null;
  t.status = document.getElementById('e_status').value;
  t.completionDate = (t.status==='Completed') ? (document.getElementById('e_completionDate').value || new Date().toISOString().split('T')[0]) : null;
  saveToStorageAndRender();
  closeEditModal();
}
function closeEditModal(){ editingId = null; document.getElementById('editModal').style.display = 'none'; }

/* add/update from add form handled earlier as addOrUpdate */

/* delete flow - custom modal */
function openDeleteModal(id){
  deleteTargetId = id;
  document.getElementById('deleteModal').style.display = 'flex';
}
function closeDeleteModal(){ deleteTargetId = null; document.getElementById('deleteModal').style.display = 'none'; }
function confirmDelete(){
  if (!deleteTargetId) return closeDeleteModal();
  tasks = tasks.filter(t=>t.id !== deleteTargetId);
  saveToStorage();
  closeDeleteModal();
  render();
}

/* helper to save + render */
function saveToStorageAndRender(){ saveToStorage(); render(); }

/* export/import */
function exportTasks(){
  const blob = new Blob([JSON.stringify(tasks, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'tasks.json'; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}
function handleImport(e){
  const file = e.target.files[0];
  if (!file) return;
  const r = new FileReader();
  r.onload = (ev)=>{
    try {
      const imported = JSON.parse(ev.target.result);
      if (!Array.isArray(imported)) throw new Error('Invalid format');
      for (const it of imported){ if (!it.id) it.id = uid(); }
      tasks = imported.concat(tasks);
      saveToStorage(); render();
      alert('Import successful');
    } catch(err){ alert('Import failed: ' + err.message); }
  };
  r.readAsText(file);
  e.target.value = '';
}

/* clear all (dev) */
function clearAll(){
  if (!confirm('Clear ALL tasks?')) return;
  tasks = [];
  saveToStorage(); render();
}

/* button: open import file input */
document.getElementById('importBtn').addEventListener('click', ()=>document.getElementById('importFile').click());

/* save edit modal binding (duplicate safe) */
document.getElementById('modalSave').addEventListener('click', saveEdit);
document.getElementById('modalCancel').addEventListener('click', closeEditModal);

/* add form save binding */
document.getElementById('saveBtn').addEventListener('click', addOrUpdate);

/* addOrUpdate implemented earlier as addOrUpdate function alias for addOrUpdate() */
function addOrUpdate(){
  const title = document.getElementById("title").value.trim();
  if (!title){ alert('Enter title'); return; }
  if (editingId){
    // (shouldn't normally happen) use edit modal to edit; here treat as new
  }
  const task = {
    id: uid(),
    title,
    desc: document.getElementById('desc').value.trim(),
    category: document.getElementById('category').value,
    priority: document.getElementById('priority').value,
    dueDate: document.getElementById('dueDate').value || null,
    status: document.getElementById('status').value,
    completionDate: document.getElementById('completionDate').value || null,
    createdAt: new Date().toISOString()
  };
  tasks.unshift(task);
  saveToStorage();
  resetForm();
  render();
}

/* save helper */
function saveToStorage(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }

/* render initial */
function renderInitial(){ loadFromStorage(); render(); }
renderInitial();

/* utils (exposed) */
function setActiveFilterBtn(filter){
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.dataset.filter === filter));
  currentFilter = filter;
}

/* expose clearAll to button */
document.getElementById('clearAllBtn').addEventListener('click', clearAll);

/* final: ensure completion row visibility in edit modal when status changes */
document.getElementById('e_status').addEventListener('change', ()=>{
  document.getElementById('e_completionRow').style.display = (document.getElementById('e_status').value === 'Completed') ? 'block' : 'none';
});
</script>
</body>
</html>
